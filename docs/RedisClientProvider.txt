package config;

import io.vertx.core.Vertx;
import io.vertx.redis.client.Redis;
import io.vertx.redis.client.RedisOptions;

import static config.Constants.*;

public class RedisClientProvider {

    private static Redis client;


    public static Redis getInstance(Vertx vertx) {
        if (client == null) {
            RedisOptions options = new RedisOptions()
                    .setConnectionString("redis://" +
                            Environment.getEnv(REDIS_HOST) + ":" +
                            Environment.getEnv(REDIS_PORT))
                    .setMaxPoolSize(Environment.getEnv(
                            REDIS_MAX_TOTAL) != null ? Integer.parseInt(Environment.getEnv(REDIS_MAX_TOTAL)) : 10)
                    .setPoolCleanerInterval(10000); // 10 seconds
            client = Redis.createClient(vertx, options);
        }
        return client;
    }

    private RedisClientProvider() {
        throw new IllegalStateException(MSG_INSTANCE);
    }
}
